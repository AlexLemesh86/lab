![](RackMultipart20210520-4-1bxx8tc_html_138b21deb32ad2c2.jpg)

**Лабораторная работа. Развертывание коммутируемой сети с резервными каналами**

1. **Топология**

![image](https://user-images.githubusercontent.com/80053204/119026026-62066880-b9ad-11eb-97d3-7cbb53525623.png)

1. **Таблица адресации**

| Устройство | Интерфейс | IP-адрес | Маска подсети |
| --- | --- | --- | --- |
| S1 | VLAN 1 | 192.168.1.1 | 255.255.255.0 |
| S2 | VLAN 1 | 192.168.1.2 | 255.255.255.0 |
| S3 | VLAN 1 | 192.168.1.3 | 255.255.255.0 |

2. **Цели**

**Часть 1. Создание сети и настройка основных параметров устройства**

**Часть 2. Выбор корневого моста**

**Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов**

**Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов**

1. **Общие сведения/сценарий**

Избыточность позволяет увеличить доступность устройств в топологии сети за счёт устранения единой точки отказа. Избыточность в коммутируемой сети обеспечивается посредством использования нескольких коммутаторов или нескольких каналов между коммутаторами. Когда в проекте сети используется физическая избыточность, возможно возникновение петель и дублирование кадров.

Протокол spanning-tree (STP) был разработан как механизм предотвращения возникновения петель на 2-м уровне для избыточных каналов коммутируемой сети. Протокол STP обеспечивает наличие только одного логического пути между всеми узлами назначения в сети путем намеренного блокирования резервных путей, которые могли бы вызвать петлю.

В этой лабораторной работе команда **show spanning-tree** используется для наблюдения за процессом выбора протоколом STP корневого моста. Также вы будете наблюдать за процессом выбора портов с учетом стоимости и приоритета.

**Примечание**. Используются коммутаторы Cisco Catalyst 2960s с Cisco IOS версии 15.0(2) (образ lanbasek9). Допускается использование других моделей коммутаторов и других версий Cisco IOS. В зависимости от модели устройства и версии Cisco IOS доступные команды и результаты их выполнения могут отличаться от тех, которые показаны в лабораторных работах.

**Примечание**. Убедитесь, что все настройки коммутатора удалены и загрузочная конфигурация отсутствует. Если вы не уверены, обратитесь к инструктору.

1. **Необходимые ресурсы**

- 3 коммутатора (Cisco 2960 с операционной системой Cisco IOS 15.0(2) (образ lanbasek9) или аналогичная модель)
- Консольные кабели для настройки устройств Cisco IOS через консольные порты
- Кабели Ethernet, расположенные в соответствии с топологией

1. **Создание сети и настройка основных параметров устройства**

В части 1 вам предстоит настроить топологию сети и основные параметры маршрутизаторов.

  1. **Создайте сеть согласно топологии.**

Подключите устройства, как показано в топологии, и подсоедините необходимые кабели.

  1. **Выполните инициализацию и перезагрузку коммутаторов.**
  2. **Настройте базовые параметры каждого коммутатора.**
    1. Отключите поиск DNS.
    2. Присвойте имена устройствам в соответствии с топологией.
    3. Назначьте **class** в качестве зашифрованного пароля доступа к привилегированному режиму.
    4. Назначьте **cisco** в качестве паролей консоли и VTY и активируйте вход для консоли и VTY каналов.
    5. Настройте logging synchronous для консольного канала.
    6. Настройте баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.
    7. Задайте IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.
    8. Скопируйте текущую конфигурацию в файл загрузочной конфигурации.
  3. **Проверьте связь.**

Проверьте способность компьютеров обмениваться эхо-запросами.

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2?

![image](https://user-images.githubusercontent.com/80053204/119026097-777b9280-b9ad-11eb-8c0a-dfc09a6266b0.png)

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3?

![image](https://user-images.githubusercontent.com/80053204/119026132-7fd3cd80-b9ad-11eb-8270-865243d9b10d.png)

Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3?

![image](https://user-images.githubusercontent.com/80053204/119026162-882c0880-b9ad-11eb-8e99-a22b22c35415.png)

Выполняйте отладку до тех пор, пока ответы на все вопросы не будут положительными.

1. **Определение корневого моста**

Для каждого экземпляра протокола spanning-tree (коммутируемая сеть LAN или широковещательный домен) существует коммутатор, выделенный в качестве корневого моста. Корневой мост служит точкой привязки для всех расчётов протокола spanning-tree, позволяя определить избыточные пути, которые следует заблокировать.

Процесс выбора определяет, какой из коммутаторов станет корневым мостом. Коммутатор с наименьшим значением идентификатора моста (BID) становится корневым мостом. Идентификатор BID состоит из значения приоритета моста, расширенного идентификатора системы и MAC-адреса коммутатора. Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096. По умолчанию используется значение 32768.

  1. **Отключите все порты на коммутаторах.**
  2. **Настройте подключенные порты в качестве транковых.**

![image](https://user-images.githubusercontent.com/80053204/119026227-97ab5180-b9ad-11eb-94e3-62fe9807a95e.png)

![image](https://user-images.githubusercontent.com/80053204/119026248-9e39c900-b9ad-11eb-9f36-f41ce1ea39df.png)

![image](https://user-images.githubusercontent.com/80053204/119026267-a2fe7d00-b9ad-11eb-8fa9-801d4af3d74f.png)
 
 1. **Включите порты F0/2 и F0/4 на всех коммутаторах.**

![image](https://user-images.githubusercontent.com/80053204/119026326-b4478980-b9ad-11eb-993a-0e3d39e893ea.png)

![image](https://user-images.githubusercontent.com/80053204/119026343-b90c3d80-b9ad-11eb-9e34-d1dcd9c4dcd5.png)

![image](https://user-images.githubusercontent.com/80053204/119026360-bdd0f180-b9ad-11eb-95bc-c3f52ed17245.png)

  1. **Отобразите данные протокола spanning-tree.**

Введите команду **show spanning-tree** на всех трех коммутаторах. Приоритет идентификатора моста рассчитывается путем сложения значений приоритета и расширенного идентификатора системы. Расширенным идентификатором системы всегда является номер сети VLAN. В примере ниже все три коммутатора имеют равные значения приоритета идентификатора моста (32769 = 32768 + 1, где приоритет по умолчанию = 32768, номер сети VLAN = 1); следовательно, коммутатор с самым низким значением MAC-адреса становится корневым мостом (в примере — S2).

![image](https://user-images.githubusercontent.com/80053204/119026406-cd503a80-b9ad-11eb-996d-e03c6db41d45.png)

![image](https://user-images.githubusercontent.com/80053204/119026424-d3461b80-b9ad-11eb-8a5f-54879653a843.png)

![image](https://user-images.githubusercontent.com/80053204/119026438-d8a36600-b9ad-11eb-9fc7-8d94efb2f0e2.png)

**Примечание**. Режим STP по умолчанию на коммутаторе 2960 — протокол STP для каждой сети VLAN (PVST).

В схему ниже запишите роль и состояние (Sts) активных портов на каждом коммутаторе в топологии.

![image](https://user-images.githubusercontent.com/80053204/119027353-e60d2000-b9ae-11eb-81fd-36571cf115dc.png)
 
С учетом выходных данных, поступающих с коммутаторов, ответьте на следующие вопросы.

Какой коммутатор является корневым мостом? **S2**

Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?

**Т.к. это коммутатор с самым низким значением MAC-адреса**

Какие порты на коммутаторе являются корневыми портами? На S2 **их нет, на**  **S1** и **S3** **это порты**  **F0/2**

Какие порты на коммутаторе являются назначенными портами? **F0/2** и **F0/4**

Какой порт отображается в качестве альтернативного и в настоящее время заблокирован? **F0/4** на **S1**

Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?

**Т.к. у него самая высокая стоимость пути**

1. **Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов**

Алгоритм протокола spanning-tree (STA) использует корневой мост как точку привязки, после чего определяет, какие порты будут заблокированы, исходя из стоимости пути. Порт с более низкой стоимостью пути является предпочтительным. Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Наиболее низкие значения являются предпочтительными. В части 3 вам предстоит изменить стоимость порта, чтобы определить, какой порт будет заблокирован протоколом spanning-tree.

  1. **Определите коммутатор с заблокированным портом.**

При текущей конфигурации только один коммутатор может содержать заблокированный протоколом STP порт. Выполните команду **show spanning-tree** на обоих коммутаторах некорневого моста. ![](RackMultipart20210520-4-1bxx8tc_html_c8579547117ca780.png)

![image](https://user-images.githubusercontent.com/80053204/119026876-59626200-b9ae-11eb-92ea-2957b6faab8e.png)
![image](https://user-images.githubusercontent.com/80053204/119026960-726b1300-b9ae-11eb-842d-5712bfe1334a.png)

**Примечание**. В конкретной топологии корневой мост может отличаться от выбора порта.

  1. **Измените стоимость порта.**

Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшите стоимость этого порта корневого моста до 18, выполнив команду **spanning-tree cost 18** режима конфигурации интерфейса.

![image](https://user-images.githubusercontent.com/80053204/119026992-7d25a800-b9ae-11eb-8ac2-5488dbed9c34.png)

2. **Просмотрите изменения протокола spanning-tree.**

Повторно выполните команду **show spanning-tree** на обоих коммутаторах некорневого моста. Обратите внимание, что ранее заблокированный порт (S1 – F0/4) теперь является назначенным портом, и протокол spanning-tree теперь блокирует порт на другом коммутаторе некорневого моста (S3 – F0/4).

S1# **show spanning-tree**

VLAN0001

Spanning tree enabled protocol ieee

Root ID Priority 32769

Address 0cd9.96d2.4000

Cost 18

Port 2 (FastEthernet0/2)

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Bridge ID Priority 32769 (priority 32768 sys-id-ext 1)

Address 0cd9.96e8.8a00

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Aging Time 300 sec

Interface Role Sts Cost Prio.Nbr Type

------------------- ---- --- --------- -------- --------------------------------

Fa0/2 Root FWD 18 128.2 P2p

Fa0/4 Desg FWD 19 128.4 P2p

S3# **show spanning-tree**

VLAN0001

Spanning tree enabled protocol ieee

Root ID Priority 32769

Address 0cd9.96d2.4000

Cost 19

Port 2 (FastEthernet0/2)

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Bridge ID Priority 32769 (priority 32768 sys-id-ext 1)

Address 0cd9.96e8.7400

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Aging Time 300 sec

Interface Role Sts Cost Prio.Nbr Type

------------------- ---- --- --------- -------- --------------------------------

Fa0/2 Root FWD 19 128.2 P2p

Fa0/4Altn BLK 19 128.4 P2p

Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе?

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

  1. **Удалите изменения стоимости порта.**
    1. Выполните команду **no spanning-tree cost 18** режима конфигурации интерфейса, чтобы удалить запись стоимости, созданную ранее.

S1(config)# **interface f0/2**

S1(config-if)# **no spanning-tree cost 18**

    1. Повторно выполните команду **show spanning-tree** , чтобы подтвердить, что протокол STP сбросил порт на коммутаторе некорневого моста, вернув исходные настройки порта. Протоколу STP требуется примерно 30 секунд, чтобы завершить процесс перевода порта.
1. **Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов**

Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Значение приоритета по умолчанию — 128. STP объединяет приоритет порта с номером порта, чтобы разорвать связи. Наиболее низкие значения являются предпочтительными. В части 4 вам предстоит активировать избыточные пути до каждого из коммутаторов, чтобы просмотреть, каким образом протокол STP выбирает порт с учетом приоритета портов.

    1. Включите порты F0/1 и F0/3 на всех коммутаторах.
    2. Подождите 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполните команду **show spanning-tree** на коммутаторах некорневого моста. Обратите внимание, что порт корневого моста переместился на порт с меньшим номером, связанный с коммутатором корневого моста, и заблокировал предыдущий порт корневого моста.

S1# **show spanning-tree**

VLAN0001

Spanning tree enabled protocol ieee

Root ID Priority 32769

Address 0cd9.96d2.4000

Cost 19

Port 1 (FastEthernet0/1)

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Bridge ID Priority 32769 (priority 32768 sys-id-ext 1)

Address 0cd9.96e8.8a00

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Aging Time 15 sec

Interface Role Sts Cost Prio.Nbr Type

------------------- ---- --- --------- -------- --------------------------------

Fa0/1Root FWD 19 128.1 P2p

Fa0/2Altn BLK 19 128.2 P2p

Fa0/3 Altn BLK 19 128.3 P2p

Fa0/4 Altn BLK 19 128.4 P2p

S3# **show spanning-tree**

VLAN0001

Spanning tree enabled protocol ieee

Root ID Priority 32769

Address 0cd9.96d2.4000

Cost 19

Port 1 (FastEthernet0/1)

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Bridge ID Priority 32769 (priority 32768 sys-id-ext 1)

Address 0cd9.96e8.7400

Hello Time 2 sec Max Age 20 sec Forward Delay 15 sec

Aging Time 15 sec

Interface Role Sts Cost Prio.Nbr Type

------------------- ---- --- --------- -------- --------------------------------

Fa0/1Root FWD 19 128.1 P2p

Fa0/2Altn BLK 19 128.2 P2p

Fa0/3 Desg FWD 19 128.3 P2p

Fa0/4 Desg FWD 19 128.4 P2p

Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста? \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

1. **Вопросы для повторения**
  1. Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

  1. Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

  1. Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

© Компания Cisco и/или ее аффилированные компании, 2021 г. Все права защищены.
 В данном документе содержится публичная информация компании Cisco. Страница **1** из **10**
